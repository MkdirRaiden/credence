generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String         @id @default(uuid())
  email           String         @unique
  phone           String?        @unique
  passwordHash    String?
  referralCode    String?        @unique
  referredById    String? 
  referredBy      User?          @relation("Referrals", fields: [referredById], references: [id])
  referrals       User[]         @relation("Referrals")
  role            UserRole       @default(USER)
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  credits         CreditLedger[]
}

model CreditLedger {
  id          String       @id @default(uuid())
  user        User         @relation(fields: [userId], references: [id])
  userId      String
  type        CreditType
  amount      Int
  status      CreditStatus @default(ACTIVE)
  referralId  String?     
  operationId String?      @unique
  expiresAt   DateTime?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
}

enum UserRole {
  USER
  ADMIN
}

enum CreditType {
  ISSUE
  REVOKE
  REFUND
}

enum CreditStatus {
  ACTIVE
  REVOKED
  EXPIRED
}

